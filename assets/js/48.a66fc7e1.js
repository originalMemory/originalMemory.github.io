(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{477:function(a,t,s){"use strict";s.r(t);var r=s(17),e=Object(r.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"algorithm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#algorithm"}},[a._v("#")]),a._v(" Algorithm")]),a._v(" "),s("p",[s("RouterLink",{attrs:{to:"/pages/8faffe/"}},[a._v("盛最多水的容器")])],1),a._v(" "),s("h2",{attrs:{id:"review"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#review"}},[a._v("#")]),a._v(" Review")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://medium.com/traveloka-engineering/our-journey-in-reducing-traveloka-ios-apps-build-time-by-90-3f875ff9a9b7",target:"_blank",rel:"noopener noreferrer"}},[a._v("Our Journey in Reducing Traveloka iOS App’s Build Time by 90%"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"三个挑战"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三个挑战"}},[a._v("#")]),a._v(" 三个挑战")]),a._v(" "),s("ol",[s("li",[a._v("巨大整体应用")]),a._v(" "),s("li",[a._v("Swift 和 OC 混编")]),a._v(" "),s("li",[a._v("不可靠的 Xcode 缓存")])]),a._v(" "),s("h3",{attrs:{id:"旅程1-集成-buck-构建系统"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#旅程1-集成-buck-构建系统"}},[a._v("#")]),a._v(" 旅程1：集成 Buck 构建系统")]),a._v(" "),s("p",[a._v("选择使用 Buck 的原因是因为它是目前仅有的支持混编的构建系统。")]),a._v(" "),s("h4",{attrs:{id:"问题-头文件引入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题-头文件引入"}},[a._v("#")]),a._v(" 问题：头文件引入")]),a._v(" "),s("p",[a._v("Buck 引入外部依赖时使用尖括号的样式引入公共头文件 "),s("code",[a._v("#import <header_prefix/header_file.h>")]),a._v(" ，使用双引号引入私有头文件 "),s("code",[a._v("#import “header_file.h”")]),a._v(" 。然而大部分第三方依赖如 CocoaPods 是允许两种混用的。这类冲突可以通过添加头文件映射文件解决。")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("apple_library"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n  name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"MyLibrary"')]),a._v(",\n  exported_headers "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" glob"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"MyLibary/**/*.h"')]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(",\n  srcs "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" glob"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"MyLibrary/**/*.m"')]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n  preprocessor_flags "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-I'),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("location //path_to_another_lib:rule_name"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#%s,private-headers")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v('"')]),a._v(" % read_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"cxx"')]),a._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"default_platform"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" \n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br")])]),s("h4",{attrs:{id:"结果-编译时间瓶颈-单测"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#结果-编译时间瓶颈-单测"}},[a._v("#")]),a._v(" 结果：编译时间瓶颈：单测")]),a._v(" "),s("p",[a._v("迁移后单测编译时间是原来的三倍。原因主要有2个。")]),a._v(" "),s("ul",[s("li",[a._v("Archiving the Traveloka app.")]),a._v(" "),s("li",[a._v("Creating test bundles.")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://illusion-blog.oss-cn-beijing.aliyuncs.com/img/2021-12-23-18-50-02.png",alt:"2021-12-23-18-50-02"}})]),a._v(" "),s("p",[a._v("主要原因是通过 ibtool 和 actool 编译 xib 和矢量回复您比较耗时。")]),a._v(" "),s("h3",{attrs:{id:"旅程2-应用模块化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#旅程2-应用模块化"}},[a._v("#")]),a._v(" 旅程2：应用模块化")]),a._v(" "),s("h4",{attrs:{id:"模块化原则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#模块化原则"}},[a._v("#")]),a._v(" 模块化原则")]),a._v(" "),s("ol",[s("li",[a._v("模块分级。每个模块必须有明确的分级，用于管理模块间依赖关系。")]),a._v(" "),s("li",[a._v("限制依赖。只有高级模块可以依赖低级模块。")]),a._v(" "),s("li",[a._v("自底向上迁移。在分极后从最底层开始迁移。")]),a._v(" "),s("li",[a._v("代码重复。如果一个模块只依赖于一个类或对象，最好是复制类或对象。因为引入的模块的所有类和对象都会被编译。")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://illusion-blog.oss-cn-beijing.aliyuncs.com/img/202112241515024.png",alt:"img"}})]),a._v(" "),s("h4",{attrs:{id:"monorepo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#monorepo"}},[a._v("#")]),a._v(" Monorepo")]),a._v(" "),s("p",[a._v("使用 Monorepo 来管理所有人代码。")]),a._v(" "),s("h4",{attrs:{id:"sandboxapp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sandboxapp"}},[a._v("#")]),a._v(" SandboxApp")]),a._v(" "),s("p",[a._v("通过它来较为快速的编译不同的模块。")]),a._v(" "),s("h2",{attrs:{id:"tip"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tip"}},[a._v("#")]),a._v(" Tip")]),a._v(" "),s("h2",{attrs:{id:"share"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#share"}},[a._v("#")]),a._v(" Share")])])}),[],!1,null,null,null);t.default=e.exports}}]);