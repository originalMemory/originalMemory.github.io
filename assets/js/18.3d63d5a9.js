(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{448:function(t,s,a){"use strict";a.r(s);var n=a(17),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("[toc]")]),t._v(" "),a("h2",{attrs:{id:"有趣原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#有趣原理"}},[t._v("#")]),t._v(" 有趣原理")]),t._v(" "),a("h3",{attrs:{id:"mixins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mixins"}},[t._v("#")]),t._v(" Mixins")]),t._v(" "),a("p",[t._v("相同的方法会被覆盖，以 "),a("code",[t._v("with")]),t._v(" 后面的顺序按顺序覆盖。")]),t._v(" "),a("h3",{attrs:{id:"widgetsflutterbinding"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#widgetsflutterbinding"}},[t._v("#")]),t._v(" WidgetsFlutterBinding")]),t._v(" "),a("p",[t._v("Flutter 启动流程中 "),a("code",[t._v("runApp()")]),t._v(" 内调用，作为入口承担了各类的初始化及功能配置。它基于 Mixins 来混合实现。")]),t._v(" "),a("div",{staticClass:"language-dart line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WidgetsFlutterBinding")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BindingBase")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GestureBinding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SchedulerBinding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServicesBinding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PaintingBinding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SemanticsBinding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RendererBinding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WidgetsBinding")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h3",{attrs:{id:"inheritedwidget"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#inheritedwidget"}},[t._v("#")]),t._v(" InheritedWidget")]),t._v(" "),a("div",{staticClass:"language-dart line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("abstract")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InheritedWidget")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProxyWidget")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// Abstract const constructor. This constructor enables subclasses to provide")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// const constructors so that they can be used in const expressions.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InheritedWidget")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Key")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" required "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Widget")]),t._v(" child "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InheritedElement")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InheritedElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// Whether the framework should notify widgets that inherit from this widget.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("///")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// When this widget is rebuilt, sometimes we need to rebuild the widgets that")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// inherit from this widget but sometimes we do not. For example, if the data")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// held by this widget is the same as the data held by `oldWidget`, then we")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// do not need to rebuild the widgets that inherited the data held by")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// `oldWidget`.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("///")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// The framework distinguishes these cases by calling this function with the")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// widget that previously occupied this location in the tree as an argument.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// The given widget is guaranteed to have the same [runtimeType] as this")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// object.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@protected")]),t._v("\n  bool "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateShouldNotify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("covariant")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InheritedWidget")]),t._v(" oldWidget"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br")])]),a("ul",[a("li",[t._v("createElement()：创建 "),a("code",[t._v("InheritedElement")]),t._v(" ，依靠它将自身添加到 "),a("code",[t._v("_inheritedWidgets")]),t._v(" 中， Element 树中的基于 "),a("code",[t._v("InheritedWidget")]),t._v(" 的子结点会继承父节点的 "),a("code",[t._v("_inheritedWidgets")]),t._v(" 并将自身也添加进去。一些状态管理框架如 Provider 即是基于该特性开发的。\n"),a("ul",[a("li",[t._v("在 "),a("code",[t._v("InheritedElement")]),t._v(" 中通过 "),a("code",[t._v("notifyClients()")]),t._v(" 来刷新 UI 。")])])]),t._v(" "),a("li",[t._v("updateShouldNotify()：为 true 时通知依赖该 Widget 的实例更新。")])]),t._v(" "),a("h4",{attrs:{id:"buildcontext"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#buildcontext"}},[t._v("#")]),t._v(" BuildContext")]),t._v(" "),a("p",[t._v("本身只是一个接口，在 "),a("code",[t._v("Element")]),t._v(" 中实现了该方法。平时开发中获取的 "),a("code",[t._v("context")]),t._v(" 实际是 "),a("code",[t._v("Element")]),t._v(" 的实例。")]),t._v(" "),a("div",{staticClass:"language-dart line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("abstract")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Element")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DiagnosticableTree")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BuildContext")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// Creates an element that uses the given widget as its configuration.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("///")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// Typically called by an override of [Widget.createElement].")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Element")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Widget")]),t._v(" widget"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("widget "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      _widget "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" widget"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Element")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" _parent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("h3",{attrs:{id:"theme"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#theme"}},[t._v("#")]),t._v(" Theme")]),t._v(" "),a("p",[t._v("以 Theme 为例，在 "),a("code",[t._v("MaterialApp")]),t._v(" 里想要获取主题颜色时通常调用 "),a("code",[t._v("Theme.of(context).primaryColor")]),t._v(" 。")]),t._v(" "),a("p",[t._v("之所以能这么做是因为内部实现时存在如下嵌套： "),a("code",[t._v("MaterialApp -> AnimatedTheme -> Theme -> _InheritedTheme(extended InheritedWidget)")]),t._v(" ，所以在内部的 Widget 中能通过上面的方法获取到主题色。")]),t._v(" "),a("div",{staticClass:"language-dart line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThemeData")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("of")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BuildContext")]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" _InheritedTheme"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" inheritedTheme "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dependOnInheritedWidgetOfExactType"),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("_InheritedTheme"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MaterialLocalizations")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" localizations "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Localizations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("of"),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MaterialLocalizations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MaterialLocalizations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ScriptCategory")]),t._v(" category "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" localizations"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scriptCategory "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ScriptCategory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("englishLike"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThemeData")]),t._v(" theme "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" inheritedTheme"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("theme"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" _kFallbackTheme"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThemeData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("localize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("theme"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" theme"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("typography"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("geometryThemeFor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("category"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("其实就是通过 "),a("code",[t._v("context.dependOnInheritedWidgetOfExactType<_InheritedTheme>()")]),t._v(" 获取到了 "),a("code",[t._v("_InheritedTheme")]),t._v(" 后再获取具体的主题数据。")]),t._v(" "),a("div",{staticClass:"language-dart line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InheritedWidget")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dependOnInheritedElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InheritedElement")]),t._v(" ancestor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" aspect "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ancestor "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    _dependencies "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HashSet")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InheritedElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    _dependencies"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ancestor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ancestor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateDependencies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" aspect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ancestor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("widget"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("T")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" dependOnInheritedWidgetOfExactType"),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("T")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InheritedWidget")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" aspect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_debugCheckStateIsActiveForAncestorLookup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InheritedElement")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" ancestor "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _inheritedWidgets "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" _inheritedWidgets"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("T")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ancestor "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ancestor "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("is")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InheritedElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dependOnInheritedElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ancestor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" aspect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" aspect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("as")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("T")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    _hadUnsatisfiedDependencies "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br")])]),a("p",[t._v("其中在 "),a("code",[t._v("dependOnInheritedElement()")]),t._v(" 内会注册依赖关系，这样当 "),a("code",[t._v("InheritedWidget")]),t._v(" 发生变化时，会通知依赖它的子孙结点。如果不想在变化时触发子孙结点刷榜，可以使用 "),a("code",[t._v("getElementForInheritedWidgetOfExactType()")]),t._v(" 来获取，它不会调用 "),a("code",[t._v("dependOnInheritedElement()")]),t._v(" 去注册依赖。")]),t._v(" "),a("h3",{attrs:{id:"container"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#container"}},[t._v("#")]),t._v(" Container")]),t._v(" "),a("p",[a("code",[t._v("Container")]),t._v(" 内部其实就是对其他单一功能的 Widget 做了封装，根据参数用不同的 Widget 把 child 包起来。所有当只有单一属性时，部分约束较严的 lint  规则会提示使用对应的 Widget 。")]),t._v(" "),a("div",{staticClass:"language-dart line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Widget")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BuildContext")]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Widget")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" current "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("child "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("constraints "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("constraints"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isTight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      current "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LimitedBox")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        maxWidth"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        maxHeight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConstrainedBox")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("constraints"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BoxConstraints")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("expand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("alignment "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      current "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Align")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("alignment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" alignment"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EdgeInsetsGeometry")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" effectivePadding "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _paddingIncludingDecoration"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("effectivePadding "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      current "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Padding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("padding"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" effectivePadding"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("color "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      current "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ColoredBox")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("color"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" color"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("clipBehavior "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Clip")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("decoration "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      current "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ClipPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        clipper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_DecorationClipper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n          textDirection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Directionality")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("maybeOf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          decoration"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" decoration"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        clipBehavior"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" clipBehavior"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("decoration "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      current "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DecoratedBox")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("decoration"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" decoration"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("foregroundDecoration "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      current "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DecoratedBox")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        decoration"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" foregroundDecoration"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        position"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DecorationPosition")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("foreground"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("constraints "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      current "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConstrainedBox")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("constraints"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" constraints"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("margin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      current "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Padding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("padding"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" margin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("transform "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      current "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Transform")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("transform"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" transform"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" alignment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" transformAlignment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" current"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br"),a("span",{staticClass:"line-number"},[t._v("39")]),a("br"),a("span",{staticClass:"line-number"},[t._v("40")]),a("br"),a("span",{staticClass:"line-number"},[t._v("41")]),a("br"),a("span",{staticClass:"line-number"},[t._v("42")]),a("br"),a("span",{staticClass:"line-number"},[t._v("43")]),a("br"),a("span",{staticClass:"line-number"},[t._v("44")]),a("br"),a("span",{staticClass:"line-number"},[t._v("45")]),a("br"),a("span",{staticClass:"line-number"},[t._v("46")]),a("br"),a("span",{staticClass:"line-number"},[t._v("47")]),a("br"),a("span",{staticClass:"line-number"},[t._v("48")]),a("br"),a("span",{staticClass:"line-number"},[t._v("49")]),a("br"),a("span",{staticClass:"line-number"},[t._v("50")]),a("br"),a("span",{staticClass:"line-number"},[t._v("51")]),a("br"),a("span",{staticClass:"line-number"},[t._v("52")]),a("br"),a("span",{staticClass:"line-number"},[t._v("53")]),a("br"),a("span",{staticClass:"line-number"},[t._v("54")]),a("br"),a("span",{staticClass:"line-number"},[t._v("55")]),a("br"),a("span",{staticClass:"line-number"},[t._v("56")]),a("br")])]),a("h3",{attrs:{id:"widget"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#widget"}},[t._v("#")]),t._v(" Widget")]),t._v(" "),a("p",[t._v("Widget 不是真正的渲染对象，只是配置描述。 "),a("code",[t._v("Widget")]),t._v(" 通过 "),a("code",[t._v("createElemnt()")]),t._v(" 和 "),a("code",[t._v("createRenderObject()")]),t._v(" 创建 "),a("code",[t._v("Element")]),t._v(" 和 "),a("code",[t._v("RenderObject")]),t._v(" ， "),a("code",[t._v("Element")]),t._v(" 同时持有 "),a("code",[t._v("Widget")]),t._v(" 和 "),a("code",[t._v("RenderObject")]),t._v(" 。 Flutter 最后则是通过 "),a("code",[t._v("RenderObject")]),t._v(" 来布局和绘制。")]),t._v(" "),a("h4",{attrs:{id:"renderbox"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#renderbox"}},[t._v("#")]),t._v(" RenderBox")]),t._v(" "),a("blockquote",[a("p",[t._v("A render object in a 2D Cartesian coordinate system.")])]),t._v(" "),a("p",[t._v("它在继承  "),a("code",[t._v("RenderObject")]),t._v(" 的基础布局和绘制上，实现了 "),a("strong",[t._v("笛卡尔坐标系")]),t._v(" ：以 Top、Left 为基点，通过宽高两个轴实现布局和嵌套。")]),t._v(" "),a("p",[t._v("在通过 "),a("code",[t._v("GlobalKey")]),t._v(" 获取宽高时使用的 "),a("code",[t._v("globalKey.currentContext?.findRenderObject()")]),t._v(" 取到的实际就是 "),a("code",[t._v("RenderBox")]),t._v(" 。")]),t._v(" "),a("h2",{attrs:{id:"深入理解-widget"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#深入理解-widget"}},[t._v("#")]),t._v(" 深入理解 Widget")]),t._v(" "),a("h3",{attrs:{id:"单子元素布局"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单子元素布局"}},[t._v("#")]),t._v(" 单子元素布局")]),t._v(" "),a("p",[t._v("如 "),a("code",[t._v("Aligin")]),t._v(" ， "),a("code",[t._v("Padding")]),t._v(" 等只有一个元素的 "),a("code",[t._v("Widget")]),t._v(" 。 "),a("code",[t._v("Container")]),t._v(" 也是这个范筹，它看似功能繁杂，但内部其实是对诸多单子元素的封装。不同的 "),a("code",[t._v("Widget")]),t._v(" 重写 "),a("code",[t._v("createRenderObject()")]),t._v(" 以创建不同的 "),a("code",[t._v("RenderBox")]),t._v(" ，进行实现不同的布局样式，部分 "),a("code",[t._v("Widget")]),t._v(" 和 "),a("code",[t._v("RenderBox")]),t._v(" 的对应关系如下：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Widget")]),t._v(" "),a("th",[t._v("RenderObject")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("ConstrainedBox")]),t._v(" "),a("td",[t._v("RenderConstrainedBox")])]),t._v(" "),a("tr",[a("td",[t._v("Align")]),t._v(" "),a("td",[t._v("RenderPositionedBox")])]),t._v(" "),a("tr",[a("td",[t._v("Padding")]),t._v(" "),a("td",[t._v("RenderPadding")])]),t._v(" "),a("tr",[a("td",[t._v("Transform")]),t._v(" "),a("td",[t._v("RenderTransform")])]),t._v(" "),a("tr",[a("td",[t._v("Offstage")]),t._v(" "),a("td",[t._v("RenderOffstage")])])])]),t._v(" "),a("p",[t._v("所以 "),a("strong",[t._v("真正的布局和大小计算等行为，均是在 "),a("code",[t._v("RenderBox")]),t._v(" 上去实现的")]),t._v(" 。以 "),a("code",[t._v("RenderOffstage")]),t._v(" 为例，")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://illusion-blog.oss-cn-beijing.aliyuncs.com/img/202112031354622.png",alt:"img"}})]),t._v(" "),a("p",[t._v("创建 "),a("code",[t._v("Offstage")]),t._v(" 时传入的 "),a("code",[t._v("offstage")]),t._v(" 实际是在此处被使用。")]),t._v(" "),a("p",[t._v("如果想越过 "),a("code",[t._v("Widget")]),t._v(" 直接使用 "),a("code",[t._v("RenderBox")]),t._v(" 去布局也是可以的。 "),a("code",[t._v("CustomSingleChildLayout")]),t._v(" 就提供了这个功能。")]),t._v(" "),a("h3",{attrs:{id:"多子元素布局"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多子元素布局"}},[t._v("#")]),t._v(" 多子元素布局")]),t._v(" "),a("p",[t._v("如 "),a("code",[t._v("Row")]),t._v(" , "),a("code",[t._v("Column")]),t._v(" 等继承自 "),a("code",[t._v("Flex")]),t._v(" ，而 "),a("code",[t._v("Flex")]),t._v(" 和 "),a("code",[t._v("Stack")]),t._v(" 等继承了 "),a("code",[t._v("MultiChildRenderObjectWidget")]),t._v(" 并通过 "),a("code",[t._v("RenderFlex")]),t._v(" 创建了 "),a("code",[t._v("RenderBox")]),t._v(" 。")]),t._v(" "),a("h3",{attrs:{id:"多子元素滑动布局"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多子元素滑动布局"}},[t._v("#")]),t._v(" 多子元素滑动布局")]),t._v(" "),a("p",[t._v("如 "),a("code",[t._v("ListView")]),t._v(" ， "),a("code",[t._v("GrideView")]),t._v(" 等，实现相对复杂，见下图：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://illusion-blog.oss-cn-beijing.aliyuncs.com/img/202112061311859.png",alt:"img"}})]),t._v(" "),a("p",[t._v("最后会产生2个 "),a("code",[t._v("RenderObject")]),t._v(" ：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("RenderSliver")]),t._v(" ："),a("em",[t._v("Base class for the render objects that implement scroll effects in viewports.")])]),t._v(" "),a("li",[a("code",[t._v("RenderViewport")]),t._v(" ："),a("em",[t._v("A render object that is bigger on the inside.")])])]),t._v(" "),a("div",{staticClass:"language-dart line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// [RenderViewport] cannot contain [RenderBox] children directly. Instead, use")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// a [RenderSliverList], [RenderSliverFixedExtentList], [RenderSliverGrid], or")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// a [RenderSliverToBoxAdapter], for example.")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[a("code",[t._v("RenderViewport")]),t._v(" 对应的 "),a("code",[t._v("Widget")]),t._v(" "),a("code",[t._v("ViewPort")]),t._v(" 就是一个 "),a("code",[t._v("MultiChildRenderObjectWidget")]),t._v(" 。")]),t._v(" "),a("p",[t._v("上图逻辑可简要描述为： 一个“可滑动( "),a("code",[t._v("Scrollable")]),t._v(" )”的控件，嵌套了一个“视觉窗口( "),a("code",[t._v("ViewPort")]),t._v(" )”，然后在内部通过“碎片( "),a("code",[t._v("Sliver")]),t._v(" )” 。")]),t._v(" "),a("p",[t._v("其中 "),a("code",[t._v("PageView")]),t._v(" 稍有些不同，它是直接通过 "),a("code",[t._v("NotificationListener")]),t._v(" 和 "),a("code",[t._v("ScrollNotification")]),t._v(" 嵌套实现的。 "),a("code",[t._v("TabBarView")]),t._v(" 内部则是 "),a("code",[t._v("NotificationListener")]),t._v(" + "),a("code",[t._v("PageView")]),t._v(" 。")]),t._v(" "),a("h2",{attrs:{id:"深入绘制原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#深入绘制原理"}},[t._v("#")]),t._v(" 深入绘制原理")]),t._v(" "),a("p",[t._v("Flutter 只要求系统提供的“Canvas”，然后开发者通过 Widget 生成 "),a("code",[t._v("RenderObject")]),t._v(" “直接”通过引擎绘制到屏幕上。")]),t._v(" "),a("h3",{attrs:{id:"绘制过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#绘制过程"}},[t._v("#")]),t._v(" 绘制过程")]),t._v(" "),a("p",[t._v("首先是 "),a("code",[t._v("RenderObject")]),t._v(" 的 "),a("code",[t._v("paint()")]),t._v(" 方法。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://illusion-blog.oss-cn-beijing.aliyuncs.com/img/202112151322783.png",alt:"img"}})]),t._v(" "),a("ul",[a("li",[a("code",[t._v("PaintingContext")]),t._v(" 的关键是 "),a("strong",[t._v("A place to paint")]),t._v("  ，同时它在父类 "),a("code",[t._v("ClipContext")]),t._v(" 是包含有 "),a("code",[t._v("Canvas")]),t._v(" ，并且其构造方法也是 "),a("code",[t._v("@protected")]),t._v(" ，只在 "),a("code",[t._v("PaintingContext.repaintCompositedChild")]),t._v(" 和 "),a("code",[t._v("pushLayer")]),t._v(" 时自动创建。")]),t._v(" "),a("li",[a("code",[t._v("Offset")]),t._v(" 主要是提供当前控件在屏幕的偏移值，提供绘制时确定绘制的坐标。")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://illusion-blog.oss-cn-beijing.aliyuncs.com/img/202112151326178.png",alt:"image2 (1240×785)"}})]),t._v(" "),a("p",[a("code",[t._v("PaintingContext")]),t._v(" 的创建是在 "),a("code",[t._v("runApp")]),t._v(" 时通过 "),a("code",[t._v("WidgetFlutterBinding")]),t._v(" 启动，经过如下过程创建。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://illusion-blog.oss-cn-beijing.aliyuncs.com/img/202112151326972.png",alt:"img"}})]),t._v(" "),a("p",[a("code",[t._v("Offset")]),t._v(" 则是父控件和子控件的 offset 相加之后逐级传递的。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://illusion-blog.oss-cn-beijing.aliyuncs.com/img/202112151326463.png",alt:"img"}})]),t._v(" "),a("p",[a("strong",[t._v("画出界也是可以的")]),t._v("："),a("code",[t._v("PaintingContext")]),t._v(" 有参数 "),a("code",[t._v("estimatedBounds")]),t._v(" ，它是创建时通过 "),a("code",[t._v("child.paintBounds")]),t._v(" 赋值的，但是并没有严格约束绘制区域，绘制出边界也是可以的。")]),t._v(" "),a("p",[t._v("不过这仅限于使用 "),a("code",[t._v("Canvas")]),t._v(" 直接进行绘制的情况，如果是通过 "),a("code",[t._v("Container")]),t._v(" 等 Widget 进行绘制，越界时会报错。")]),t._v(" "),a("h4",{attrs:{id:"repaintboundary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#repaintboundary"}},[t._v("#")]),t._v(" RepaintBoundary")]),t._v(" "),a("p",[t._v("每次调用 "),a("code",[t._v("markNeedsPaint()")]),t._v(" 时，"),a("code",[t._v("RenderObject")]),t._v(" 会逐级向上查找，根据 "),a("code",[t._v("isRepaintBoundary")]),t._v(" 确定更新区域，再通过 "),a("code",[t._v("requestVisualUpdate")]),t._v(" 触发更新向下绘制。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://illusion-blog.oss-cn-beijing.aliyuncs.com/img/202112151345641.png",alt:"img"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://illusion-blog.oss-cn-beijing.aliyuncs.com/img/202112151344640.png",alt:"img"}})]),t._v(" "),a("p",[a("strong",[t._v("如果一个控制绘制很频繁，且不影响父控件时，可以令 "),a("code",[t._v("isRepaintBoundary")]),t._v(" 为 true")]),t._v(" 。")]),t._v(" "),a("h4",{attrs:{id:"layer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#layer"}},[t._v("#")]),t._v(" Layer")]),t._v(" "),a("p",[t._v("当 "),a("code",[t._v("isRepaintBoundary")]),t._v(" 为 true 时，即为可更新绘制区域，"),a("code",[t._v("RenderOjbect")]),t._v(" 会创建一个对应的 "),a("code",[t._v("Layer")]),t._v(" 。示例如 "),a("code",[t._v("OffsetLayer")]),t._v(" ，它用于定位绘制。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://illusion-blog.oss-cn-beijing.aliyuncs.com/img/202112201332317.png",alt:"img"}})]),t._v(" "),a("p",[t._v("在 "),a("code",[t._v("RenderObject")]),t._v(" 中还有一个 "),a("code",[t._v("needsCompositing")]),t._v(" ，它会影响要生成多少层的 "),a("code",[t._v("Layer")]),t._v(" ，而 "),a("code",[t._v("Layer")]),t._v(" 又会组成一个 "),a("code",[t._v("Layer Tree")]),t._v(" 。它才是真正给引擎去绘制的树。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://illusion-blog.oss-cn-beijing.aliyuncs.com/img/202112201332825.png",alt:"img"}})]),t._v(" "),a("h3",{attrs:{id:"slider-的绘制原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#slider-的绘制原理"}},[t._v("#")]),t._v(" Slider 的绘制原理")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://illusion-blog.oss-cn-beijing.aliyuncs.com/img/202112201339971.gif",alt:"img"}})]),t._v(" "),a("p",[a("code",[t._v("Slider")]),t._v(" 中除了手势和动画外，其他绘制部分均是由独立的模块完成绘制，这些模块均是由 "),a("code",[t._v("SliderTheme")]),t._v(" 的 "),a("code",[t._v("SliderThemeData")]),t._v(" 提供的。")]),t._v(" "),a("p",[t._v("如果想自定义 "),a("code",[t._v("Slider")]),t._v(" 可以通过嵌套 "),a("code",[t._v("SliderTheme")]),t._v(" 和自定义的 "),a("code",[t._v("SliderThemeData")]),t._v(" 来实现。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://illusion-blog.oss-cn-beijing.aliyuncs.com/img/202112201340755.png",alt:"img"}})]),t._v(" "),a("p",[t._v("而手势和动画之所以响应画面，也是因为其中调用了 "),a("code",[t._v("markNeedsPaint")]),t._v(" 方法。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://illusion-blog.oss-cn-beijing.aliyuncs.com/img/202112201347948.png",alt:"img"}})]),t._v(" "),a("h2",{attrs:{id:"图片加载解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#图片加载解析"}},[t._v("#")]),t._v(" 图片加载解析")]),t._v(" "),a("h3",{attrs:{id:"加载流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#加载流程"}},[t._v("#")]),t._v(" 加载流程")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://illusion-blog.oss-cn-beijing.aliyuncs.com/img/202112221324566.png",alt:"img"}})]),t._v(" "),a("p",[t._v("核心是三个角色：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Image")]),t._v(" ：用于显示图片的 Widget ，最后通过内部的 "),a("code",[t._v("RenderImage")]),t._v(" 绘制。")]),t._v(" "),a("li",[a("code",[t._v("ImageProvider")]),t._v(" ：通过子类如 "),a("code",[t._v("NetworkImage")]),t._v(" 实现真正加载图片的逻辑，返回 "),a("code",[t._v("ImageStream")]),t._v(" 用于监听结果。")]),t._v(" "),a("li",[a("code",[t._v("ImageStream")]),t._v(" ：图片的加载对象，通过 "),a("code",[t._v("ImageStreamCompleter")]),t._v(" 返回一个 "),a("code",[t._v("ImageInfo")]),t._v(" ，内含有 "),a("code",[t._v("RenderImage")]),t._v(" 最后的绘制对象 "),a("code",[t._v("ui.Image")]),t._v(" 。")])]),t._v(" "),a("p",[t._v("以网络图片为例，是通过 "),a("code",[t._v("NetworkImage")]),t._v(" 这个 Provider 去加载的，主要是实现了以下几个方法。")]),t._v(" "),a("h4",{attrs:{id:"obtainkey"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#obtainkey"}},[t._v("#")]),t._v(" obtainKey")]),t._v(" "),a("p",[t._v("主要用于内存缓存判断。在 "),a("code",[t._v("NetworkImage")]),t._v(" 中它和 "),a("code",[t._v("url")]),t._v(" 、 "),a("code",[t._v("runtimeType")]),t._v(" 、"),a("code",[t._v("scale")]),t._v(" 有关，任意一个不同均会认为不一样。")]),t._v(" "),a("h4",{attrs:{id:"load-t-key"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#load-t-key"}},[t._v("#")]),t._v(" load(T key)")]),t._v(" "),a("p",[t._v("加载逻辑。返回的是 "),a("code",[t._v("ImageSreamCompleter")]),t._v(" 抽象对象。主要用于 "),a("strong",[t._v("管理和通知 "),a("code",[t._v("ImageStream")]),t._v(" 中得到的 "),a("code",[t._v("dart:ui.Image")])]),t._v(" 。")]),t._v(" "),a("h4",{attrs:{id:"resolve"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#resolve"}},[t._v("#")]),t._v(" resolve")]),t._v(" "),a("p",[t._v("核心解析方法。上面所定义的 "),a("code",[t._v("obtainKey")]),t._v(" 和 "),a("code",[t._v("load")]),t._v(" 均在此处调用。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://illusion-blog.oss-cn-beijing.aliyuncs.com/img/202112311334132.png",alt:"img"}})]),t._v(" "),a("p",[t._v("通过 "),a("code",[t._v("PaintingBinding.instance.imageCache.putIfAbsent(key, () => load(key)")]),t._v(" 判断是否有缓存，有则直接返回 "),a("code",[t._v("ImageStreamCompleter")]),t._v(" ，无则调用 "),a("code",[t._v("loader")]),t._v(" 去加载并返回。")]),t._v(" "),a("p",[t._v("和通常理解的 key-bitmap 型的 "),a("code",[t._v("cache")]),t._v(" 不一样，Flutter 中缓存是 "),a("code",[t._v("ImageStreamCompleter")]),t._v(" 对象，而不是实际绘制使用的 "),a("code",[t._v("dart:ui.Image")]),t._v(" 。在 "),a("code",[t._v("putIfAbsent")]),t._v(" 里有两个状态，因为 "),a("code",[t._v("ImageStreamCompleter")]),t._v(" 不表示加载已经结束了，所以在首次加载时，会有 "),a("code",[t._v("_PendingImage")]),t._v(" 标志该图片是 "),a("code",[t._v("加载中")]),t._v(" 并添加一个 "),a("code",[t._v("listener")]),t._v(" ，直到真正加载结束后再替换为缓存 "),a("code",[t._v("_CacheImage")]),t._v(" 。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://illusion-blog.oss-cn-beijing.aliyuncs.com/img/202112311344453.png",alt:"img"}})]),t._v(" "),a("h4",{attrs:{id:"imagestreamcompleter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#imagestreamcompleter"}},[t._v("#")]),t._v(" ImageStreamCompleter")]),t._v(" "),a("p",[t._v("一个抽象类，用于管理和通知")]),t._v(" "),a("p",[t._v("https://guoshuyu.cn/home/wx/Flutter-7.html")])])}),[],!1,null,null,null);s.default=e.exports}}]);